<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - Messages | CRACOE</title>
  <link rel="icon" href="quorics-logo.png" type="image/png">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'IBM Plex Mono', monospace; }
    .message-card { transition: all 0.3s ease; }
    .message-card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
  </style>
</head>
<body class="bg-gray-100 min-h-screen">
  <!-- Login Modal -->
  <div id="login-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
      <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Admin Login</h2>
      <form id="login-form">
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
          <input type="text" id="username" required class="w-full border border-gray-300 rounded px-3 py-2 focus:border-black focus:outline-none">
        </div>
        <div class="mb-6">
          <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
          <input type="password" id="password" required class="w-full border border-gray-300 rounded px-3 py-2 focus:border-black focus:outline-none">
        </div>
        <button type="submit" class="w-full bg-black text-white py-2 rounded hover:bg-gray-800 transition-colors">
          Login
        </button>
      </form>
      <div id="login-error" class="mt-4 text-red-600 text-sm text-center hidden"></div>
    </div>
  </div>

  <div id="admin-content" class="container mx-auto px-4 py-8" style="display: none;">
    <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
      <h1 class="text-3xl font-bold text-gray-800 mb-2">Contact Messages</h1>
      <p class="text-gray-600">Manage incoming contact form submissions</p>
      <button onclick="loadMessages()" class="mt-4 bg-black text-white px-4 py-2 rounded hover:bg-gray-800 transition-colors mr-2">
        Refresh Messages
      </button>
      <button onclick="addTestMessage()" class="mt-4 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition-colors">
        Add Test Message
      </button>
      <p class="text-sm text-gray-500 mt-2">Total messages: <span id="message-count">0</span></p>
    </div>

    <div id="messages-container" class="space-y-4">
      <div class="text-center py-8">
        <p class="text-gray-500">Loading messages...</p>
      </div>
    </div>
    
    <div class="text-center mt-8">
      <button onclick="logout()" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors">
        Logout
      </button>
    </div>
  </div>

  <script>
    // Login credentials
    const ADMIN_USERNAME = 'admin';
    const ADMIN_PASSWORD = 'cracoe2025';

    // Auto logout on page events
    window.addEventListener('beforeunload', logout);
    window.addEventListener('pagehide', logout);
    document.addEventListener('visibilitychange', function() {
      if (document.hidden) logout();
    });

    // Check if already logged in
    if (sessionStorage.getItem('admin_logged_in') === 'true') {
      showAdminPanel();
    }

    // Login form handler
    document.getElementById('login-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      
      if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
        sessionStorage.setItem('admin_logged_in', 'true');
        showAdminPanel();
      } else {
        document.getElementById('login-error').textContent = 'Invalid credentials';
        document.getElementById('login-error').classList.remove('hidden');
      }
    });

    function showAdminPanel() {
      document.getElementById('login-modal').style.display = 'none';
      document.getElementById('admin-content').style.display = 'block';
      loadMessages();
    }

    function logout() {
      sessionStorage.removeItem('admin_logged_in');
      window.location.href = 'contact.html';
    }

    function addTestMessage() {
      const testMessage = {
        id: Date.now(),
        timestamp: new Date().toISOString(),
        name: 'Test User',
        email: 'test@example.com',
        phone: '+1234567890',
        company: 'Test Company',
        message: 'This is a test message to verify the system is working.'
      };
      
      try {
        const messages = JSON.parse(localStorage.getItem('cracoe_messages') || '[]');
        messages.push(testMessage);
        localStorage.setItem('cracoe_messages', JSON.stringify(messages));
        loadMessages();
      } catch (error) {
        alert('Failed to save test message');
      }
    }

    function loadMessages() {
      try {
        const messages = JSON.parse(localStorage.getItem('cracoe_messages') || '[]');
        const container = document.getElementById('messages-container');
        const countElement = document.getElementById('message-count');
        
        if (countElement) {
          countElement.textContent = messages.length;
        }
        
        if (!messages || messages.length === 0) {
          container.innerHTML = `
            <div class="text-center py-8">
              <p class="text-gray-500">No messages found</p>
            </div>
          `;
          return;
        }

        container.innerHTML = messages.reverse().map(msg => `
          <div class="message-card bg-white rounded-lg shadow-md p-6 border-l-4 border-black">
            <div class="flex justify-between items-start mb-4">
              <div>
                <h3 class="text-lg font-semibold text-gray-800">${escapeHtml(msg.name)}</h3>
                <p class="text-sm text-gray-600">${escapeHtml(msg.email)}</p>
                ${msg.phone ? `<p class="text-sm text-gray-600">${escapeHtml(msg.phone)}</p>` : ''}
                ${msg.company ? `<p class="text-sm text-gray-500">${escapeHtml(msg.company)}</p>` : ''}
              </div>
              <div class="text-right">
                <p class="text-xs text-gray-500">${new Date(msg.timestamp).toLocaleString()}</p>
                <p class="text-xs text-gray-400">ID: ${msg.id}</p>
              </div>
            </div>
            <div class="bg-gray-50 rounded p-4">
              <p class="text-gray-700 whitespace-pre-wrap">${escapeHtml(msg.message)}</p>
            </div>
            <div class="mt-4 flex gap-2">
              <a href="mailto:${escapeHtml(msg.email)}" class="bg-black text-white px-3 py-1 rounded text-sm hover:bg-gray-800 transition-colors">
                Reply
              </a>
              <button onclick="deleteMessage(${msg.id})" class="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 transition-colors">
                Delete
              </button>
            </div>
          </div>
        `).join('');
      } catch (error) {
        document.getElementById('messages-container').innerHTML = `
          <div class="text-center py-8">
            <p class="text-red-500">Error loading messages: ${error.message}</p>
          </div>
        `;
      }
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function deleteMessage(id) {
      if (confirm('Are you sure you want to delete this message?')) {
        try {
          const messages = JSON.parse(localStorage.getItem('cracoe_messages') || '[]');
          const filtered = messages.filter(msg => msg.id !== id);
          localStorage.setItem('cracoe_messages', JSON.stringify(filtered));
          loadMessages();
        } catch (error) {
          alert('Failed to delete message');
        }
      }
    }

    // Load messages on page load
    loadMessages();
  </script>
</body>
</html>